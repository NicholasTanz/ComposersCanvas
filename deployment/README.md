# Deployment Instructions

**Composers Canvas** uses **Cloud Run** for the deployment of both the **frontend** and **backend** services, with **Cloud SQL** handling the database. Follow the steps below to deploy the services.

---

## Frontend Deployment

1. **Frontend Configuration**  
   Deploy the built frontend image to **Cloud Run** with the following settings:

   - **Container Port:** `8080` (default)
   - **Authentication:** Select **Allow unauthenticated invocations** (since the login system is not yet implemented).
   - **Minimum Instances:** Set to `1` (no need for more than one instance at the moment).
   - **All other settings:** Leave as default.

Note:
- when building the docker image, utilize the following command:
```bash
docker build --build-arg VITE_BACKEND_URL="<deployed_backend_url>" -f ./frontend/dockerfile.prod -t gcr.io/ece49595-seniordesign/frontend ./frontend
```
---

## Backend Deployment

1. **Backend Configuration**  
   Deploy the backend image to Cloud Run with the following settings:

   - **Authentication:** Select **Allow unauthenticated invocations** (since the login system is not yet implemented).
   - **Docker Image:** Select the Docker image for the backend service.
   - **Service Scaling:** Set to `1` instance (no need for more than one instance at the moment).

2. **Container, Volumes, Networking, and Security Settings**  
   Configure the following under **Container(s), Volumes, Networking, Security**:

   - **Container Port:** `5000`
   - **Cloud SQL Connection:** Select the available option (this will be our database).
   - **Environment Variable:**
     - Set the `DATABASE_URL` environment variable to the connection string for the database.
     - Set the `CORS_ORIGIN` environment variable to the frontend URL.
     - Set the `SECRET_KEY` environment variable to a secret key for the backend.
     The secret key can be generated by running the following command:
     ```bash
       python -c 'import secrets; print(secrets.token_urlsafe(16))'
       ```

---

## Side Notes

- **Number of Docker Images:**  
  - We have a total of 4 Docker imagesâ€”2 for the frontend and 2 for the backend. The reason for this is that we maintain separate images for local development and production environments for both services.  
  In the future, we plan to unify these images to reduce the number of images we need to manage, simplifying the deployment process.
  - Whenever you need to utilize the database, make sure to hit 'START' on the Cloud SQL instance to allow the backend service to connect to the database. We disable it to save costs when not in use.